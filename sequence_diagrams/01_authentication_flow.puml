@startuml MindCare-IA_Core_Authentication_Flow
!theme plain
skinparam participant {
    BackgroundColor #F8F9FA
    BorderColor #6C757D
    FontName "Arial"
    FontSize 10
}

title MindCare-IA Platform - Core Authentication & User Management Flow
actor Patient as P
actor Therapist as T
participant "Authentication\nService" as Auth
participant "User\nManagement" as User
participant "Notification\nSystem" as Notif
participant "Database" as DB

== User Registration Flow ==

P -> Auth: register(email, password, "patient")
Auth -> User: create_user_profile(patient_data)
User -> DB: save_user_data()
Auth -> Notif: send_verification_email(email)
Notif -> P: verification_email_sent
Auth -> P: registration_pending_verification

P -> Auth: verify_email(verification_token)
Auth -> User: activate_account(user_id)
User -> DB: update_user_status(active=True)
Auth -> P: account_activated_successfully

== User Login Flow ==

P -> Auth: login(email, password)
Auth -> DB: validate_credentials()
DB -> Auth: user_data + profile_info
Auth -> User: get_user_profile(user_id)
User -> DB: fetch_profile_details()
User -> Auth: complete_profile_data
Auth -> P: authentication_token + user_profile

== Profile Management ==

P -> User: update_profile(name, phone, preferences)
User -> DB: save_profile_changes()
User -> P: profile_updated_successfully

P -> User: upload_profile_picture(image_file)
User -> DB: save_image_metadata()
User -> P: profile_picture_updated

== Therapist Registration ==

T -> Auth: register(email, password, "therapist")
Auth -> User: create_therapist_profile(therapist_data)
User -> DB: save_therapist_data()
Auth -> Notif: send_verification_email(email)
Auth -> T: registration_pending_verification

T -> Auth: verify_email(verification_token)
Auth -> User: activate_therapist_account(user_id)
User -> DB: update_therapist_status(active=True)
Auth -> T: therapist_account_activated

T -> User: update_credentials(license_number, specialization)
User -> DB: save_therapist_credentials()
User -> T: credentials_updated

@enduml
